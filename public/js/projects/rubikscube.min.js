function mouseMove(t){var e=canvas.getBoundingClientRect();mouse.pos.set(t.clientX-e.left,t.clientY-e.top)}function mouseUp(t){mouse.leftPress&&0===t.button&&(mouse.animationProcess=!0,cube.calculateAngle(),cube.rotateAnimation()),mouse.scrollPress&&1===t.button&&(cube.updatePosition(),mouse.scrollPress=!1,rotateCubeAngle=0),mouse.rightPress&&2===t.button&&(mouse.rightPress=!1,rotateCubeAngle=0)}function mouseDown(t){if(mouse.scrollPress||mouse.leftPress||mouse.rightPress)return!1;var e=canvas.getBoundingClientRect();mouse.click.set(t.clientX-e.left,t.clientY-e.top),mouse.pos.set(t.clientX-e.left,t.clientY-e.top+1e-9),mouse.resetLazy(),0===t.button?mouse.leftPress=!0:1===t.button?mouse.scrollPress=!0:2===t.button&&(mouse.rightPress=!0)}function draw(){ctx.fillStyle=colors.bg,ctx.fillRect(0,0,canvasWidth,canvasHeight),rotateCubeMatrix.updateMatrix(rotateCubeAxis,rotateCubeAngle*DE),cube.rotateAll(rotateCubeMatrix),(mouse.leftPress||mouse.shakeProcess)&&(cube.activeElement(mouse.click),cube.rotatePart()),cube.fillFaces(),mouse.shakeProcess||mouse.update()}function testLog(){}function Cube(t){this.walls=t,this.showed=[],this.elementRotate=[],this.blackFill={fir:[],sec:[]},this.blackFillFace={id:-1,pid:-1},this.blackFace=new Face(new Vector,new Vector,new Vector,new Vector,colors.black),this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.extrema={min:new Point,max:new Point},this.getFace=function(t){return this.walls[t][0]},this.getChild=function(t){return this.walls[t][1]},this.getNeigh=function(t){return this.walls[t][2]},this.normalPos=function(t){return parseInt("3421".split("")[t-1])},this.rotateAll=function(t){for(var e=0;e<this.walls.length;e++){this.walls[e][0].rotate(t);for(var s=0;s<this.walls[e][1].length;s++)this.walls[e][1][s].rotate(t)}},this.printEdge=function(){for(var t=0;t<this.walls.length;t++)for(var e=0;e<this.walls[t][1].length;e++)this.walls[t][1][e].printEdge()},this.updatePosition=function(){for(var t=0;t<this.walls.length;t++){this.walls[t][0].update();for(var e=0;e<this.walls[t][1].length;e++)this.walls[t][1][e].update()}},this.fillFaces=function(){if(-1===this.faceNormal){var t=this.nearestVertex();this.showed=[];for(var e=0;e<this.walls.length;e++){var s=this.walls[e][0];Math.max(s.v1.z,s.v2.z,s.v3.z,s.v4.z)+.1>t&&this.showed.push(e);for(var i=0;i<this.walls[e][1].length;i++)this.walls[e][1][i].fill(),this.walls[e][1][i].printEdge()}}else{for(var r=0,e=0;e<this.walls.length;e++)for(var i=0;i<this.walls[e][1].length;i++)this.distance(this.walls[e][1][i].average())<2&&(this.walls[e][1][i].fill(),this.walls[e][1][i].printEdge(),this.blackFillCorr(this.walls[e][1][i],1.5));this.sort(),this.fillBlack();for(var e=0;e<this.walls.length;e++)for(var i=0;i<this.walls[e][1].length;i++)r=this.distance(this.walls[e][1][i].average()),3.5>r&&r>2&&(this.walls[e][1][i].fill(),this.walls[e][1][i].printEdge(),this.blackFillCorr(this.walls[e][1][i],3));this.sort(),this.fillBlack();for(var e=0;e<this.walls.length;e++)for(var i=0;i<this.walls[e][1].length;i++)this.distance(this.walls[e][1][i].average())>4&&(this.walls[e][1][i].fill(),this.walls[e][1][i].printEdge())}},this.fillBlack=function(){var t=this.blackFill.fir,e=this.blackFill.sec;this.blackFace.v1.set(t[0][0],t[0][1]),this.blackFace.v2.set(t[t.length-1][0],t[t.length-1][1]),this.blackFace.v3.set(e[e.length-1][0],e[e.length-1][1]),this.blackFace.v4.set(e[0][0],e[0][1]),this.blackFace.fill(colors.black),this.blackFace.printEdge(),this.blackFill={fir:[],sec:[]},this.blackFillFace.id=-1,this.blackFillFace.pid=-1},this.blackFillCorr=function(t,e){this.distance(t.v1)>e&&this.addToBlackFile(t,t.v1),this.distance(t.v2)>e&&this.addToBlackFile(t,t.v2),this.distance(t.v3)>e&&this.addToBlackFile(t,t.v3),this.distance(t.v4)>e&&this.addToBlackFile(t,t.v4)},this.addToBlackFile=function(t,e){-1===this.blackFillFace.id&&(this.blackFillFace.id=t.parentId,this.blackFillFace.pid=this.getNeigh(t.parentId).parall),this.blackFillFace.id===t.parentId?this.blackFill.fir.push([e.x,e.y]):this.blackFillFace.pid===t.parentId&&this.blackFill.sec.push([e.x,e.y])},this.sort=function(){var t=function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0},e=function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0};this.blackFill.fir.sort(t),this.blackFill.sec.sort(t),this.blackFill.fir[0][0]===this.blackFill.fir[this.blackFill.fir.length-1][0]&&(this.blackFill.fir.sort(e),this.blackFill.sec.sort(e))},this.distance=function(t){var e=this.getFace(this.faceNormal),s=e.normal.z<0?this.getNeigh(this.faceNormal).parall:this.faceNormal,i=this.getFace(s).normal,r=this.getFace(s).v1;return Math.abs(i.x*t.x+i.y*t.y+i.z*t.z+i.x*r.x+i.y*r.y+i.z*r.z)/Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)},this.nearestVertex=function(){for(var t={x:-10,y:-10,z:-10},e={x:10,y:10,z:10},s=0;s<this.walls.length;s++){var i=this.walls[s][0];t.x=Math.max(i.v1.x,i.v2.x,i.v3.x,i.v4.x,t.x),t.z=Math.max(i.v1.y,i.v2.y,i.v3.y,i.v4.y,t.y),t.z=Math.max(i.v1.z,i.v2.z,i.v3.z,i.v4.z,t.z),e.x=Math.min(i.v1.x,i.v2.x,i.v3.x,i.v4.x,e.x),e.z=Math.min(i.v1.y,i.v2.y,i.v3.y,i.v4.y,e.y),e.z=Math.min(i.v1.z,i.v2.z,i.v3.z,i.v4.z,e.z)}return this.extrema.max.set(t),this.extrema.min.set(e),this.extrema.max.z},this.rotatePart=function(){if(-1===this.dragDirection){if(dragPart.len()>10&&(this.setDragDirection(),this.faceNormal=this.choseNormalFace(),-1!==this.faceNormal)){var t=this.getFace(this.faceNormal),e=t.v1.toVector(t.v4),s=t.v1.toVector(t.v2),i=e.crossProduct(s);rotatePartAxis.setV(i),rotatePartAxis.norm(),rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE),this.checkElementToRotate()}}else if(-1!==this.clickFacesIndex){rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE);for(var r=0;r<this.elementRotate.length;r++){var o=this.elementRotate[r];this.walls[o[0]][1][o[1]].rotate(rotatePartMatrix)}}},this.setDragDirection=function(){var t=dragPart.angle2D();this.dragDirection=t>-PI4&&PI4>t?4:t>PI4&&3*PI4>t?1:t>-3*PI4&&-PI4>t?2:3},this.checkElementToRotate=function(){var t=this.clickElementIndex,e=this.clickFacesIndex;this.elementRotate=[],1===this.moveTo||2===this.moveTo?((0===e||2===e)&&this.vertical1(e,0===e?2:0,t),(1===e||3===e)&&this.vertical2(e,1===e?3:1,t),(4===e||5===e)&&this.vertical3(e,4===e?5:4,t)):4>e?this.horizontalSimple(e,t):(4===e||5===e)&&this.horizontal(e,4===e?5:4,t)},this.vertical1=function(t,e,s){var i=this.getNeigh(t);if(s%3===0||(s+1)%3===0)for(var r=s%3===0?i.left:i.right,o=0;9>o;o++)this.elementRotate.push([r,o]);this.pushEl(t,s,(s+3)%9,(s+6)%9),0===t?(this.pushEl(i.top,s,(s+3)%9,(s+6)%9),this.pushEl(i.bottom,s,(s+3)%9,(s+6)%9)):(this.pushEl(i.top,8-s,(17-s+3)%9,(17-s+6)%9),this.pushEl(i.bottom,8-s,(17-s+3)%9,(17-s+6)%9)),this.pushEl(e,8-s,(17-s+3)%9,(17-s+6)%9)},this.vertical2=function(t,e,s){var i=this.getNeigh(t);if(s%3===0||(s+1)%3===0)for(var r=s%3===0?i.left:i.right,o=0;9>o;o++)this.elementRotate.push([r,o]);var a=1===t?i.top:i.bottom,n=3===t?i.top:i.bottom,h=3*(s%3);this.pushEl(t,s,(s+3)%9,(s+6)%9),this.pushEl(a,8-h,7-h,6-h),this.pushEl(n,h,h+1,h+2),this.pushEl(e,8-s,(17-s+3)%9,(17-s+6)%9)},this.vertical3=function(t,e,s){var i=this.getNeigh(t);if(s%3===0||(s+1)%3===0)for(var r=s%3===0?i.left:i.right,o=0;9>o;o++)this.elementRotate.push([r,o]);var a=4===t?i.top:i.bottom,n=5===t?i.top:i.bottom;this.pushEl(t,s,(s+3)%9,(s+6)%9),this.pushEl(n,s,(s+3)%9,(s+6)%9),this.pushEl(a,8-s,(17-s+3)%9,(17-s+6)%9),this.pushEl(e,s,(s+3)%9,(s+6)%9)},this.horizontalSimple=function(t,e){if(3>e||e>5)for(var s=this.getNeigh(t),i=3>e?s.top:s.bottom,r=0;9>r;r++)this.elementRotate.push([i,r]);for(var o=e>2?e>5?6:3:0,r=0;4>r;r++)this.pushEl(r,o,o+1,o+2)},this.horizontal=function(t,e,s){var i=this.getNeigh(t);if(3>s||s>5)for(var r=3>s?i.top:i.bottom,o=0;9>o;o++)this.elementRotate.push([r,o]);var a=s>2?s>5?6:3:0,n=a/3,h=4===t?i.left:i.right,l=5===t?i.left:i.right;this.pushEl(t,a,a+1,a+2),this.pushEl(h,n,n+3,n+6),this.pushEl(l,2-n,5-n,8-n),this.pushEl(e,6-a,7-a,8-a)},this.pushEl=function(t,e,s,i){this.elementRotate.push([t,e]),this.elementRotate.push([t,s]),this.elementRotate.push([t,i])},this.reset=function(){this.dragDirection=-1,this.faceNormal=-1,this.clickFacesIndex=-1,this.clickElementIndex=-1,this.moveTo=-1,this.elementRotate=[]},this.choseNormalFace=function(){if(-1===this.clickFacesIndex)return-1;drag=this.dragDirection,orie=this.getFace(this.clickFacesIndex).orient;var t=0;return t=drag===orie?1:3===orie&&1===drag||4===orie&&2===drag?4:3===orie&&2===drag||4===orie&&1===drag||2===orie&&4===drag?3:(drag+orie-2)%4+1,this.moveTo=t,this.getNeigh(this.clickFacesIndex).get(this.normalPos(t))},this.activeFaceIndex=function(t){for(var e=0;e<this.showed.length;e++){var s=this.showed[e],i=this.walls[s][0];if(this.pointInideFace(i,t))return s}return-1},this.activeElement=function(t){if(-1!==this.clickElementIndex)return!0;if(this.clickFacesIndex=this.activeFaceIndex(t),-1===this.clickFacesIndex)return!1;for(var e=this.walls[this.clickFacesIndex][1],s=0;s<e.length;s++)this.pointInideFace(e[s],t)&&(this.clickElementIndex=s)},this.pointInideFace=function(t,e){var s={x:e.x,y:e.y},i={x:e.x+1e3,y:e.y},r=this.lineIntersection(t.v1.ctxPos(),t.v2.ctxPos(),s,i);return r+=this.lineIntersection(t.v2.ctxPos(),t.v3.ctxPos(),s,i),r+=this.lineIntersection(t.v3.ctxPos(),t.v4.ctxPos(),s,i),r+=this.lineIntersection(t.v4.ctxPos(),t.v1.ctxPos(),s,i),r%2},this.lineIntersection=function(t,e,s,i){var r=e.x-t.x,o=e.y-t.y,a=i.x-s.x,n=i.y-s.y,h=(-o*(t.x-s.x)+r*(t.y-s.y))/(-a*o+r*n),l=(a*(t.y-s.y)-n*(t.x-s.x))/(-a*o+r*n);return 0>h||h>1||0>l||l>1?0:1},this.rotateAnimation=function(){-1===this.clickElementIndex?(mouse.animationProcess=!1,rotatePartAngle=rotateEndAngle,this.reset(),dragPart.set(0,0),mouse.leftPress=!1,rotateCubeAngle=0,rotatePartAngle=0):Math.abs(rotateEndAngle-rotatePartAngle)<1?(mouse.animationProcess=!1,rotatePartAngle=rotateEndAngle,this.transform(),this.reset(),dragPart.set(0,0),mouse.leftPress=!1,rotateCubeAngle=0,rotatePartAngle=0):mouse.animationProcess&&(rotatePartAngle+=angleStep,setTimeout(function(){cube.rotateAnimation()},30))},this.calculateAngle=function(){for(var t=rotatePartAngle;0>t;)t+=360;t%=360,rotateCount=Math.round(t/90),rotateEndAngle=90*Math.round(rotatePartAngle/90),angleStep=(rotateEndAngle-rotatePartAngle)/15},this.transform=function(){var t=this.clickElementIndex,e=this.clickFacesIndex,s=this.moveTo;if(this.elementRotate=[],-1!==[3,4].indexOf(s)&&4>e)for(var i=0;rotateCount>i;i++)this.moveZX(t,3===this.moveTo);else if(-1!==[1,2].indexOf(s)&&-1!==[0,2,4,5].indexOf(e)){var r=1===s;r=2===e?!r:r,t=2===e?8-t:t;for(var i=0;rotateCount>i;i++)this.moveZY(t,r)}else{var r=1===s;4===e?(r=3===s,t=[6,3,0,7,4,1,8,5,2].indexOf(t)):3===e?(r=2===s,t=8-t):5===e&&(r=4===s,t=[2,5,8,1,4,7,0,3,6].indexOf(t));for(var i=0;rotateCount>i;i++)this.moveXY(t,r)}},this.moveZX=function(t,e){var s,i=[null,null,null],r=t>2?t>5?6:3:0;if(3>t&&this.rotateFace(4,e),t>5&&this.rotateFace(5,!e),e)for(var o=3;o>=0;o--)i=this.replaceGroup(o,[r,r+1,r+2],i),s=o;else for(var o=0;3>=o;o++)i=this.replaceGroup(o,[r,r+1,r+2],i),s=o;this.replaceGroup(3-s,[r,r+1,r+2],i)},this.moveXY=function(t,e){var s=[null,null,null],i=t%3;t%3===0&&this.rotateFace(0,!e),(t+1)%3===0&&this.rotateFace(2,e),e?(s=this.replaceGroup(1,[i,i+3,i+6],s),s=this.replaceGroup(4,[3*(2-i),3*(2-i)+1,3*(2-i)+2],s),s=this.replaceGroup(3,[8-i,5-i,2-i],s),s=this.replaceGroup(5,[3*i+2,3*i+1,3*i],s),s=this.replaceGroup(1,[i,i+3,i+6],s)):(s=this.replaceGroup(1,[i,i+3,i+6],s),s=this.replaceGroup(5,[3*i+2,3*i+1,3*i],s),s=this.replaceGroup(3,[8-i,5-i,2-i],s),s=this.replaceGroup(4,[3*(2-i),3*(2-i)+1,3*(2-i)+2],s),s=this.replaceGroup(1,[i,i+3,i+6],s))},this.moveZY=function(t,e){var s=[null,null,null],i=t%3;t%3===0&&this.rotateFace(3,!e),(t+1)%3===0&&this.rotateFace(1,e),e?(s=this.replaceGroup(0,[i,i+3,i+6],s),s=this.replaceGroup(4,[i,i+3,i+6],s),s=this.replaceGroup(2,[8-i,5-i,2-i],s),s=this.replaceGroup(5,[i,i+3,i+6],s),s=this.replaceGroup(0,[i,i+3,i+6],s)):(s=this.replaceGroup(0,[i,i+3,i+6],s),s=this.replaceGroup(5,[i,i+3,i+6],s),s=this.replaceGroup(2,[8-i,5-i,2-i],s),s=this.replaceGroup(4,[i,i+3,i+6],s),s=this.replaceGroup(0,[i,i+3,i+6],s))},this.rotateFace=function(t,e){if(-1===t)return!1;for(var s,i,r=[0,2,8,6,0,2],o=[1,5,7,3,1,5],a=r.length,n=null,h=null,l=0;a-1>l;l++)s=e?r[l]:r[a-1-l],i=e?o[l]:o[a-1-l],n=this.replaceColor(t,s,n),h=this.replaceColor(t,i,h)},this.replaceGroup=function(t,e,s){return[this.replaceColor(t,e[0],s[0]),this.replaceColor(t,e[1],s[1]),this.replaceColor(t,e[2],s[2])]},this.replaceColor=function(t,e,s){var i=this.walls[t][1][e].color;return this.walls[t][1][e].color=s,i},this.setVariableToShake=function(t,e,s){this.clickFacesIndex=t,this.clickElementIndex=e,this.dragDirection=s,this.faceNormal=this.choseNormalFace();var i=this.getFace(this.faceNormal),r=i.v1.toVector(i.v4),o=i.v1.toVector(i.v2),a=r.crossProduct(o);rotatePartAxis.setV(a),rotatePartAxis.norm(),rotatePartMatrix.updateMatrix(rotatePartAxis,rotatePartAngle*DE),this.checkElementToRotate()}}function Face(t,e,s,i,r,o,a){this.v1=t,this.v2=e,this.v3=s,this.v4=i,this.orient=1,this.orientVecor=new Vector(t.x-i.x,t.y-i.y,t.z-i.z),this.angle=0,this.color=r,this.id=o||0,this.parentId=a,this.show=!0,this.normal=new Vector,this.setNormal=function(){var t=this.v1.toVector(this.v4),e=this.v1.toVector(this.v2);this.normal.setV(t.crossProduct(e))},this.showToggle=function(){this.setNormal(),this.show=this.normal.z>0?!0:!1},this.average=function(){return{x:(this.v1.x+this.v2.x+this.v3.x+this.v4.x)/4,y:(this.v1.y+this.v2.y+this.v3.y+this.v4.y)/4,z:(this.v1.z+this.v2.z+this.v3.z+this.v4.z)/4}},this.setAngle=function(){var t=this.v1.y<this.v2.y?1:-1;this.orientVecor.set(this.v1.x-this.v4.x,this.v1.y-this.v4.y,this.v1.z-this.v4.z),this.angle=t*Math.acos(this.orientVecor.dotProduct(planeVec)/(this.orientVecor.len()*planeVec.len()))},this.setOrient=function(){this.setAngle(),this.angle>-PI4&&this.angle<PI4?this.orient=1:this.angle>PI4&&this.angle<3*PI4?this.orient=3:this.angle>3*PI4||this.angle<-3*PI4?this.orient=2:this.angle<-PI4&&this.angle>-3*PI4&&(this.orient=4)},this.rotate=function(t){this.v1.rotate(t),this.v2.rotate(t),this.v3.rotate(t),this.v4.rotate(t),this.setOrient(),this.showToggle()},this.update=function(){this.v1.updatePos(),this.v2.updatePos(),this.v3.updatePos(),this.v4.updatePos()},this.printEdge=function(){this.show&&(ctx.beginPath(),ctx.strokeStyle=colors.line,ctx.lineWidth=4,ctx.lineCap="round",ctx.lineJoin="round",ctx.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),ctx.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),ctx.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),ctx.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.stroke())},this.fill=function(t){this.show&&(ctx.beginPath(),ctx.fillStyle=t||colors.line,ctx.moveTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.lineTo(this.v2.ctxPos().x,this.v2.ctxPos().y),ctx.lineTo(this.v3.ctxPos().x,this.v3.ctxPos().y),ctx.lineTo(this.v4.ctxPos().x,this.v4.ctxPos().y),ctx.lineTo(this.v1.ctxPos().x,this.v1.ctxPos().y),ctx.fill(),t||this.fillRound())},this.fillRound=function(){var t=this.v2.subtract(this.v1),e=this.v3.subtract(this.v2),s=this.v4.subtract(this.v3),i=this.v1.subtract(this.v4),r=this.v4.add(i.multiply(1-radius)),o=this.v1.add(t.multiply(radius)),a=this.v1.add(t.multiply(1-radius)),n=this.v2.add(e.multiply(radius)),h=this.v2.add(e.multiply(1-radius)),l=this.v3.add(s.multiply(radius)),c=this.v3.add(s.multiply(1-radius)),u=this.v4.add(i.multiply(radius));ctx.beginPath(),ctx.fillStyle=this.color,ctx.moveTo(o.ctxPos().x,o.ctxPos().y),ctx.lineTo(a.ctxPos().x,a.ctxPos().y),ctx.quadraticCurveTo(this.v2.ctxPos().x,this.v2.ctxPos().y,n.ctxPos().x,n.ctxPos().y),ctx.lineTo(h.ctxPos().x,h.ctxPos().y),ctx.quadraticCurveTo(this.v3.ctxPos().x,this.v3.ctxPos().y,l.ctxPos().x,l.ctxPos().y),ctx.lineTo(c.ctxPos().x,c.ctxPos().y),ctx.quadraticCurveTo(this.v4.ctxPos().x,this.v4.ctxPos().y,u.ctxPos().x,u.ctxPos().y),ctx.lineTo(r.ctxPos().x,r.ctxPos().y),ctx.quadraticCurveTo(this.v1.ctxPos().x,this.v1.ctxPos().y,o.ctxPos().x,o.ctxPos().y),ctx.fill()}}function Point(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0,this.set=function(t,e,s){"number"==typeof t?(this.x=t||0,this.y=e||0,this.z=s||0):(this.x=t.x,this.y=t.y,this.z=t.z)}}function Vector(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0,this.pos=new Point(t,e,s),this.angle2D=function(){return Math.atan2(this.y,this.x)},this.ctxPos=function(){return this.scale(this)},this.scale=function(t){return{x:centerX+t.x*scale,y:centerY-t.y*scale}},this.rotate=function(t){this.setCurrentPos(t.dotProduct(this.pos))},this.len=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))},this.norm=function(){var t=this.len();this.x/=t,this.y/=t,this.z/=t},this.dotProduct=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},this.crossProduct=function(t){return new Vector(this.y*t.z-t.y*this.z,this.z*t.x-t.z*this.x,this.x*t.y-t.x*this.y)},this.set=function(t,e,s){this.x=t||0,this.y=e||0,this.z=s||0},this.setV=function(t){this.setCurrentPos(t)},this.setCurrentPos=function(t){this.x=t.x,this.y=t.y,this.z=t.z},this.setStartPoss=function(t){this.pos.x=t.x,this.pos.y=t.y,this.pos.z=t.z},this.updatePos=function(){this.pos.x=this.x,this.pos.y=this.y,this.pos.z=this.z},this.toVector=function(t){return new Vector(t.x-this.x,t.y-this.y,t.z-this.z)},this.add=function(t){return new Vector(t.x+this.x,t.y+this.y,t.z+this.z)},this.subtract=function(t){return new Vector(this.x-t.x,this.y-t.y,this.z-t.z)},this.multiply=function(t){return new Vector(t*this.x,t*this.y,t*this.z)},this.str=function(){return" x: "+this.x+" y: "+this.y+" z: "+this.z}}function Matrix(t,e,s){this.v1=t,this.v2=e,this.v3=s,this.result=new Point,this.dotProduct=function(t){return this.result.x=this.v1.x*t.x+this.v1.y*t.y+this.v1.z*t.z,this.result.y=this.v2.x*t.x+this.v2.y*t.y+this.v2.z*t.z,this.result.z=this.v3.x*t.x+this.v3.y*t.y+this.v3.z*t.z,this.result}}function RotateMatrix(t,e,s){Matrix.call(this,t,e,s),this.updateMatrix=function(t,e){var s=cos(e),i=sin(e),r=1-s,o=t.x,a=t.y,n=t.z;this.v1.set(r*o*o+s,r*o*a-n*i,r*o*n+a*i),this.v2.set(r*o*a+n*i,r*a*a+s,r*a*n-o*i),this.v3.set(r*o*n-a*i,r*a*n+o*i,r*n*n+s)}}function Neighbor(t,e,s,i,r){this.top=t,this.bottom=e,this.left=s,this.right=i,this.parall=r,this.get=function(t){return 1===t?this.top:2===t?this.bottom:3===t?this.left:4===t?this.right:void 0}}function createWall(t,e,s,i){var r=(e.x-t.x)/3,o=(e.y-t.y)/3,a=(e.z-t.z)/3,n=[];if(0===r)for(var h=0;3>h;h++)for(var l=0;3>l;l++){var c=new Vector(t.x,t.y+h*o,t.z+l*a),u=new Vector(t.x,t.y+h*o,t.z+(1+l)*a),v=new Vector(t.x,t.y+(1+h)*o,t.z+(1+l)*a),x=new Vector(t.x,t.y+(1+h)*o,t.z+l*a);n.push(new Face(c,u,v,x,s,3*h+l,i))}if(0===o)for(var h=0;3>h;h++)for(var l=0;3>l;l++){var c=new Vector(t.x+l*r,t.y,t.z+h*a),u=new Vector(t.x+(1+l)*r,t.y,t.z+h*a),v=new Vector(t.x+(1+l)*r,t.y,t.z+(1+h)*a),x=new Vector(t.x+l*r,t.y,t.z+(1+h)*a);n.push(new Face(c,u,v,x,s||randomColor(),3*h+l,i))}if(0===a)for(var h=0;3>h;h++)for(var l=0;3>l;l++){var c=new Vector(t.x+l*r,t.y+h*o,t.z),u=new Vector(t.x+(1+l)*r,t.y+h*o,t.z),v=new Vector(t.x+(1+l)*r,t.y+(1+h)*o,t.z),x=new Vector(t.x+l*r,t.y+(1+h)*o,t.z);n.push(new Face(c,u,v,x,s||randomColor(),3*h+l,i))}return n}function randomColor(){for(var t="0123456789ABCDEF".split(""),e="#",s=0;6>s;s++)e+=t[Math.floor(16*Math.random())];return e}function cos(t){return Math.cos(t)}function sin(t){return Math.sin(t)}function hexToRgba(t,e){t=t.replace("#","");var s=parseInt(t,16),i=s>>16&255,r=s>>8&255,o=255&s;return"rgba("+i+", "+r+", "+o+", "+(e||1)+")"}function init(){canvas=document.getElementById("cubic"),canvasHeight=window.innerHeight,canvasWidth=window.innerWidth,centerX=canvasWidth/2,centerY=canvasHeight/2,scale=0,canvas.height=canvasHeight,canvas.width=canvasWidth,ctx=canvas.getContext("2d"),setInterval(draw,50),zoom()}function zoom(){50>scale?(rotateCubeAngle+=1,scale+=2,setTimeout(zoom,50)):(cube.updatePosition(),rotateCubeAngle=0,shake())}function shake(){if(shakeRepetCount<shakeCount)mouse.leftPress=!1,mouse.shakeProcess=!1,start();else{shakeCount++;var t=randInt(1,4);shakeAngleEnd=90*t,shakeAngleStep=shakeAngleEnd/(4*t),cube.setVariableToShake(randInt(0,6),randInt(0,9),randInt(1,5)),mouse.leftPress=!0,mouse.shakeProcess=!0,shakeRotate()}}function shakeRotate(){Math.abs(rotatePartAngle-shakeAngleEnd)>1?(rotatePartAngle+=shakeAngleStep,setTimeout(shakeRotate,50)):(rotatePartAngle=shakeAngleEnd,cube.calculateAngle(),cube.transform(),cube.reset(),rotatePartAngle=0,setTimeout(shake,200))}function randInt(t,e){return Math.floor(Math.random()*(e-t))+t}function start(){document.getElementById("info").classList.add("hidden"),document.addEventListener("mouseup",mouseUp),canvas.addEventListener("mousedown",mouseDown),canvas.addEventListener("mouseup",mouseUp),canvas.addEventListener("mousemove",mouseMove)}var DE=Math.PI/180,PI=Math.PI,PI4=Math.PI/4,rotateCubeAxis=new Vector(1,1,0),rotatePartAxis=new Vector(0,0,0),dragCube=new Vector,dragPart=new Vector,planeVec=new Vector(0,1,0),rotateCubeAngle=0,rotatePartAngle=0,rotateEndAngle=0,angleStep=0,rotateCount=0,canvas,ctx,canvasWidth=900,canvasHeight=600,centerX=canvasWidth/2,centerY=canvasHeight/2,scale=0,radius=.3,shakeRepetCount=20,shakeCount=0,shakeAngleEnd=0,shakeAngleStep=0,colors={red:"#BF1E2E",green:"#00A652",blue:"#303193",orange:"#F6941D",yellow:"#FFF100",white:"#FFFFFF",bg:"#DADADA",line:"#282828",black:"#403F3F"},mouse={pos:new Point,lazy:new Point,click:new Point,leftPress:!1,scrollPress:!1,rightPress:!1,block:!1,animationProcess:!1,shakeProcess:!1,updateLazy:function(){this.lazy.x+=.3*(this.pos.x-this.lazy.x),this.lazy.y+=.3*(this.pos.y-this.lazy.y)},resetLazy:function(){this.lazy.set(this.pos)},update:function(){if(this.shakeProcess)return!1;if(this.updateLazy(),this.scrollPress)dragCube.set(this.lazy.x-this.click.x,this.click.y-this.lazy.y),rotateCubeAxis.set(-dragCube.y,dragCube.x),rotateCubeAxis.norm(),rotateCubeAngle=dragCube.len()/100*36;else if(this.leftPress&&!this.animationProcess){var t=this.lazy.x-this.click.x,e=this.click.y-this.lazy.y;dragPart.set(t,e),rotatePartAngle=1===cube.dragDirection?e/70*36:2===cube.dragDirection?-e/70*36:3===cube.dragDirection?-t/70*36:t/70*36}}},rotateCubeMatrix=new RotateMatrix(new Vector,new Vector,new Vector),rotatePartMatrix=new RotateMatrix(new Vector,new Vector,new Vector),vertex1=new Vector(-3,3,3),vertex2=new Vector(3,3,3),vertex3=new Vector(3,-3,3),vertex4=new Vector(-3,-3,3),vertex5=new Vector(-3,3,-3),vertex6=new Vector(3,3,-3),vertex7=new Vector(3,-3,-3),vertex8=new Vector(-3,-3,-3),faceA=new Face(vertex1,vertex2,vertex3,vertex4,colors.blue,0),faceB=new Face(vertex2,vertex6,vertex7,vertex3,colors.green,1),faceC=new Face(vertex6,vertex5,vertex8,vertex7,colors.orange,2),faceD=new Face(vertex5,vertex1,vertex4,vertex8,colors.red,3),faceE=new Face(vertex5,vertex6,vertex2,vertex1,colors.white,4),faceF=new Face(vertex4,vertex3,vertex7,vertex8,colors.yellow,5),wallA=[faceA,createWall(vertex1,vertex3,colors.blue,0),new Neighbor(4,5,3,1,2)],wallB=[faceB,createWall(vertex2,vertex7,colors.green,1),new Neighbor(4,5,0,2,3)],wallC=[faceC,createWall(vertex6,vertex8,colors.orange,2),new Neighbor(4,5,1,3,0)],wallD=[faceD,createWall(vertex5,vertex4,colors.red,3),new Neighbor(4,5,2,0,1)],wallE=[faceE,createWall(vertex5,vertex2,colors.white,4),new Neighbor(2,0,3,1,5)],wallF=[faceF,createWall(vertex4,vertex7,colors.yellow,5),new Neighbor(0,2,3,1,4)],cube=new Cube([wallA,wallB,wallC,wallD,wallE,wallF]);RotateMatrix.prototype=Object.create(Matrix.prototype),RotateMatrix.prototype.constructor=RotateMatrix,document.addEventListener("DOMContentLoaded",init);